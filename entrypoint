#!/bin/bash

set -eux

# Testing, avoid all permission issues
chmod 775 /Pxls -R

cd /Pxls && echo "cd Successful"

cp /pxls.conf ./pxls.conf

## Database Config ##
sed -i "s|@dbhost@|$dbhost|g" ./pxls.conf
sed -i "s|@dbport@|$dbport|g" ./pxls.conf
sed -i "s|@dbuser@|$dbuser|g" ./pxls.conf
sed -i "s|@dbpass@|${dbpass}|g" ./pxls.conf
sed -i "s|@dbname@|$dbname|g" ./pxls.conf

sed -i "s|@ipaddress@|$ipaddress|g" ./pxls.conf

## Authentication Config ##

authenticators=( 'useip' 'callbackBase' 'redditkey' 'redditsecret' 'googlekey' 'googlesecret' 'discordkey' 'discordsecret' 'vkkey' 'vksecret' 'tumblrkey' 'tumblrsecret')

for i in "${authenticators[@]}"; do
	sed -i "s|@$i@|${!i}|g" ./pxls.conf
done

cat ./pxls.conf

java -jar ./target/pxls-1.0-SNAPSHOT.jar
